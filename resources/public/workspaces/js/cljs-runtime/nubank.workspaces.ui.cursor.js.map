{"version":3,"sources":["nubank/workspaces/ui/cursor.cljs"],"mappings":"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","names":["nubank.workspaces.ui.cursor/get-nth","i","s","cljs.core.drop","cljs.core/first","nubank.workspaces.ui.cursor/seq-prev","current","items","index","cljs.core._EQ_","item-count","cljs.core/count","next-index","cljs.core/mod","nubank.workspaces.ui.cursor/seq-next","selected-index","nubank.workspaces.ui.cursor/scroll-up","options","container","item","goog.object/get","cljs.core/last","cljs.core/next","goog.object/set","nubank.workspaces.ui.cursor/scroll-down","item-bottom","nubank.workspaces.ui.cursor/dom-props","props","cljs.core.into","cljs.core.remove","cljs.core.comp","cljs.core/namespace","options__55349__auto__","com.fulcrologic.fulcro.components/wrapped-render","map__72105","com.fulcrologic.fulcro.components/props","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","js/nubank","js/nubank.workspaces","js/nubank.workspaces.ui","js/nubank.workspaces.ui.cursor","js/nubank.workspaces.ui.cursor.VerticalCursor","props__55350__auto__","this__55351__auto__","temp__5751__auto__","init-state__55352__auto__","obj72160","G__72161","G__72162","obj72168","com.fulcrologic.fulcro.components/configure-component!","nubank.workspaces.ui.cursor/VerticalCursor","this","factory","on-change","on-select","value->key","cljs.core/pr-str","map__72097","value","com.fulcrologic.fulcro_css.localized_dom.div","p1__72093#","cljs.core.assoc","nubank.workspaces.ui.events/dom-listener","e","map__72112","next","and__4115__auto__","map__72122","p1__72094#","G__72135","G__72136","p1__72095#","iter__4529__auto__","s__72141","cljs.core/LazySeq","temp__5753__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4527__auto__","size__4528__auto__","b__72143","cljs.core/chunk-buffer","i__72142","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__72140","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","x","p1__72096#","nubank.workspaces.ui.cursor/vertical-cursor","com.fulcrologic.fulcro.components.factory","cljs.core/chunk-first"],"sourcesContent":["(ns nubank.workspaces.ui.cursor\n  (:require [com.fulcrologic.fulcro.components :as fp]\n            [com.fulcrologic.fulcro-css.localized-dom :as dom]\n            [nubank.workspaces.ui.events :as dom-events]\n            [goog.object :as gobj]))\n\n(defn get-nth [i s]\n  (->> s (drop i) first))\n\n(defn seq-prev [current items]\n  (let [index (.indexOf items current)]\n    (if (= -1 index)\n      (first items)\n      (let [item-count (count items)\n            next-index (-> (if (= 0 index)\n                             (dec item-count)\n                             (dec index))\n                           (mod item-count))]\n        (get-nth next-index items)))))\n\n(defn seq-next [current items]\n  (let [selected-index (.indexOf items current)]\n    (if (= -1 selected-index)\n      (first items)\n      (let [item-count (count items)\n            next-index (-> (if (= selected-index (dec item-count))\n                             0\n                             (inc selected-index))\n                           (mod item-count))]\n        (get-nth next-index items)))))\n\n(defn scroll-up [options container item]\n  (if item\n    (if-not (<= (gobj/get container \"scrollTop\")\n              (gobj/get item \"offsetTop\")\n              (+ (gobj/get container \"scrollTop\") (gobj/get container \"offsetHeight\")))\n      (if (= (last options) next)\n        (gobj/set container \"scrollTop\" (-> (gobj/get container \"scrollHeight\")))\n        (gobj/set container \"scrollTop\" (-> (gobj/get item \"offsetTop\")))))))\n\n(defn scroll-down [options container item]\n  (if item\n    (let [item-bottom (+ (gobj/get item \"offsetTop\")\n                        (gobj/get item \"scrollHeight\"))]\n      (if-not (<= (gobj/get container \"scrollTop\")\n                item-bottom\n                (+ (gobj/get container \"scrollTop\") (gobj/get container \"offsetHeight\")))\n        (if (= (first options) next)\n          (gobj/set container \"scrollTop\" 0)\n          (gobj/set container \"scrollTop\" (-> item-bottom\n                                              (- (gobj/get container \"offsetHeight\")))))))))\n\n(defn dom-props [props]\n  (into {} (remove (comp namespace first)) props))\n\n(fp/defsc VerticalCursor\n  [this\n   {::keys [options factory on-change on-select value->key]\n    :or    {value->key pr-str}\n    :as    props}]\n  {:css [[:.container {:overflow \"auto\"\n                       :flex     \"1\"\n                       :position \"relative\"}]]\n   :componentDidMount\n        (fn [this]\n          (let [{::keys [options value value->key]} (fp/props this)]\n            (scroll-down options\n                         (gobj/get this \"container\")\n                         (gobj/get this (str \"item-\" (value->key value))))))}\n  (dom/div :.container (dom-props (assoc props :ref #(gobj/set this \"container\" %)))\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"up\"\n        ::dom-events/action\n        (fn [e]\n          (.preventDefault e)\n          (let [{::keys [value options]} (fp/props this)\n                next      (seq-prev value options)\n                container (gobj/get this \"container\")\n                item      (gobj/get this (str \"item-\" (value->key next)))]\n            (when (and container item)\n              (scroll-up options container item)\n              (on-change next e))))))\n\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"down\"\n        ::dom-events/action\n        (fn [e]\n          (.preventDefault e)\n          (let [{::keys [value options]} (fp/props this)\n                next        (seq-next value options)\n                container   (gobj/get this \"container\")\n                item        (gobj/get this (str \"item-\" (value->key next)))]\n            (when (and container item)\n              (scroll-down options container item)\n              (on-change next e))))))\n\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"return\"\n        ::dom-events/action #(on-select (-> this fp/props ::value) %)))\n\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"escape\"\n        ::dom-events/action #(on-select nil %)))\n\n    (for [x options]\n      (dom/div {:key (value->key x)\n                :ref #(gobj/set this (str \"item-\" (value->key x)) %)}\n        (factory x)))))\n\n(def vertical-cursor (fp/factory VerticalCursor))\n"]}